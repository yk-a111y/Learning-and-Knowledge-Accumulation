## iframe方案
微前端中 iframe 方案需要一个主应用，包含导航和内容区的设计，通过切换导航来控制内容区微应用 A / B / C 的加载和卸载
![[Pasted image 20240722213539.png]]
iframe方案的特点：
- 站点隔离和浏览上下文隔离，可以使微应用在运行时天然隔离，适合集成三方应用；
- 移植性和复用性好，可以便捷地嵌在不同的主应用中

同样的，也会存在一些问题：
- 主应用刷新时， iframe 无法保持 URL 状态（会重新加载 `src` 对应的初始 URL）；
- 应用和 iframe 处于不同的浏览上下文，无法使 iframe 中的模态框相对于主应用居中；
- 主应用和 iframe 微应用的数据状态同步问题：持久化数据和通信(**即，主应用和微应用免登录的问题**)；

> 温馨提示：对于非后台管理系统而言，使用 iframe 还需要考虑 SEO、移动端兼容性、加载性能等问题

## NPM包方案
微应用 A / B / C 可以采用不同的技术栈，但是构建时需要像发布业务组件一样输出 **ES5 & 模块化标准的 JavaScript 库**，从而使主应用安装各自的依赖时，可以通过模块化的方式引入微应用。
![[Pasted image 20240725114322.png]]

NPM包这种方案，有着以下的特点：
- 微应用可以使用不同的技术栈进行开发；
- 微应用不需要进行静态资源托管，只需要发布到 NPM 仓库即可，故移植和复用方便，可直接嵌入不同主应用；
- 微应用和主应用共享浏览器的 Renderer 进程、浏览上下文和内存数据。

同时，也有一些注意事项：
- 处理主应用和各个微应用的全局变量、CSS 样式和存储数据的冲突问题；
- 微应用的构建需要做额外的配置，构建的不是应用程序而是 JavaScript 库，因此无需代码分割和静态资源分离；
- 微应用发布后，主应用需要重新安装依赖并重新构建部署。

上述描述中可得，NPM 设计仅仅适合集成一些`小型微应用`，如果微应用的资源过大，势必要对微应用的构建进行资源优化处理，例如多入口应用的三方库去重、弱网环境下 chunk 大小分离控制、懒加载、预加载等

### 设计实例
主应用 main-app代码
```js
// 注册路由
const router = createBrowserRouter([
  {
    path: "/",
    element: <App />,
    children: [
      {
        path: "react",
        element: <ReactApp />,
      },
      {
        path: "vue",
        element: <VueApp />,
      },
    ],
  },
]);
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<RouterProvider router={router} />);

// 主应用
function App() {
  return (
    <div className="app">
      <div className="app-nav">
        <p>Micro App List</p>
        <nav>
          <ul>
            <li>
              <Link to={'react'}>React Micro App</Link>
            </li>
            <li>
              <Link to={'vue'}>Vue Micro App</Link>
            </li>
          </ul>
        </nav>
      </div>
      <div className="app-content">
        <Outlet />
      </div>
    </div>
  );
}
```