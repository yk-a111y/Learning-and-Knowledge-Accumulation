"use strict";var Xt=Object.create;var ce=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var Jt=Object.getPrototypeOf,Qt=Object.prototype.hasOwnProperty;var k=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),Zt=(s,t)=>{for(var e in t)ce(s,e,{get:t[e],enumerable:!0})},ze=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Wt(t))!Qt.call(s,i)&&i!==e&&ce(s,i,{get:()=>t[i],enumerable:!(n=Yt(t,i))||n.enumerable});return s};var Kt=(s,t,e)=>(e=s!=null?Xt(Jt(s)):{},ze(t||!s||!s.__esModule?ce(e,"default",{value:s,enumerable:!0}):e,s)),en=s=>ze(ce({},"__esModule",{value:!0}),s);var Ie=k((ii,qe)=>{var tn=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{};qe.exports=tn});var Ae=k((si,Xe)=>{var nn="2.0.0",sn=Number.MAX_SAFE_INTEGER||9007199254740991,on=16,rn=250,an=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Xe.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:on,MAX_SAFE_BUILD_LENGTH:rn,MAX_SAFE_INTEGER:sn,RELEASE_TYPES:an,SEMVER_SPEC_VERSION:nn,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Se=k((F,Ye)=>{var{MAX_SAFE_COMPONENT_LENGTH:Le,MAX_SAFE_BUILD_LENGTH:ln,MAX_LENGTH:un}=Ae(),cn=Ie();F=Ye.exports={};var gn=F.re=[],dn=F.safeRe=[],g=F.src=[],pn=F.safeSrc=[],d=F.t={},mn=0,Ce="[a-zA-Z0-9-]",hn=[["\\s",1],["\\d",un],[Ce,ln]],fn=s=>{for(let[t,e]of hn)s=s.split(`${t}*`).join(`${t}{0,${e}}`).split(`${t}+`).join(`${t}{1,${e}}`);return s},m=(s,t,e)=>{let n=fn(t),i=mn++;cn(s,i,t),d[s]=i,g[i]=t,pn[i]=n,gn[i]=new RegExp(t,e?"g":void 0),dn[i]=new RegExp(n,e?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*");m("NUMERICIDENTIFIERLOOSE","\\d+");m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Ce}*`);m("MAINVERSION",`(${g[d.NUMERICIDENTIFIER]})\\.(${g[d.NUMERICIDENTIFIER]})\\.(${g[d.NUMERICIDENTIFIER]})`);m("MAINVERSIONLOOSE",`(${g[d.NUMERICIDENTIFIERLOOSE]})\\.(${g[d.NUMERICIDENTIFIERLOOSE]})\\.(${g[d.NUMERICIDENTIFIERLOOSE]})`);m("PRERELEASEIDENTIFIER",`(?:${g[d.NUMERICIDENTIFIER]}|${g[d.NONNUMERICIDENTIFIER]})`);m("PRERELEASEIDENTIFIERLOOSE",`(?:${g[d.NUMERICIDENTIFIERLOOSE]}|${g[d.NONNUMERICIDENTIFIER]})`);m("PRERELEASE",`(?:-(${g[d.PRERELEASEIDENTIFIER]}(?:\\.${g[d.PRERELEASEIDENTIFIER]})*))`);m("PRERELEASELOOSE",`(?:-?(${g[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[d.PRERELEASEIDENTIFIERLOOSE]})*))`);m("BUILDIDENTIFIER",`${Ce}+`);m("BUILD",`(?:\\+(${g[d.BUILDIDENTIFIER]}(?:\\.${g[d.BUILDIDENTIFIER]})*))`);m("FULLPLAIN",`v?${g[d.MAINVERSION]}${g[d.PRERELEASE]}?${g[d.BUILD]}?`);m("FULL",`^${g[d.FULLPLAIN]}$`);m("LOOSEPLAIN",`[v=\\s]*${g[d.MAINVERSIONLOOSE]}${g[d.PRERELEASELOOSE]}?${g[d.BUILD]}?`);m("LOOSE",`^${g[d.LOOSEPLAIN]}$`);m("GTLT","((?:<|>)?=?)");m("XRANGEIDENTIFIERLOOSE",`${g[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);m("XRANGEIDENTIFIER",`${g[d.NUMERICIDENTIFIER]}|x|X|\\*`);m("XRANGEPLAIN",`[v=\\s]*(${g[d.XRANGEIDENTIFIER]})(?:\\.(${g[d.XRANGEIDENTIFIER]})(?:\\.(${g[d.XRANGEIDENTIFIER]})(?:${g[d.PRERELEASE]})?${g[d.BUILD]}?)?)?`);m("XRANGEPLAINLOOSE",`[v=\\s]*(${g[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[d.XRANGEIDENTIFIERLOOSE]})(?:${g[d.PRERELEASELOOSE]})?${g[d.BUILD]}?)?)?`);m("XRANGE",`^${g[d.GTLT]}\\s*${g[d.XRANGEPLAIN]}$`);m("XRANGELOOSE",`^${g[d.GTLT]}\\s*${g[d.XRANGEPLAINLOOSE]}$`);m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Le}})(?:\\.(\\d{1,${Le}}))?(?:\\.(\\d{1,${Le}}))?`);m("COERCE",`${g[d.COERCEPLAIN]}(?:$|[^\\d])`);m("COERCEFULL",g[d.COERCEPLAIN]+`(?:${g[d.PRERELEASE]})?(?:${g[d.BUILD]})?(?:$|[^\\d])`);m("COERCERTL",g[d.COERCE],!0);m("COERCERTLFULL",g[d.COERCEFULL],!0);m("LONETILDE","(?:~>?)");m("TILDETRIM",`(\\s*)${g[d.LONETILDE]}\\s+`,!0);F.tildeTrimReplace="$1~";m("TILDE",`^${g[d.LONETILDE]}${g[d.XRANGEPLAIN]}$`);m("TILDELOOSE",`^${g[d.LONETILDE]}${g[d.XRANGEPLAINLOOSE]}$`);m("LONECARET","(?:\\^)");m("CARETTRIM",`(\\s*)${g[d.LONECARET]}\\s+`,!0);F.caretTrimReplace="$1^";m("CARET",`^${g[d.LONECARET]}${g[d.XRANGEPLAIN]}$`);m("CARETLOOSE",`^${g[d.LONECARET]}${g[d.XRANGEPLAINLOOSE]}$`);m("COMPARATORLOOSE",`^${g[d.GTLT]}\\s*(${g[d.LOOSEPLAIN]})$|^$`);m("COMPARATOR",`^${g[d.GTLT]}\\s*(${g[d.FULLPLAIN]})$|^$`);m("COMPARATORTRIM",`(\\s*)${g[d.GTLT]}\\s*(${g[d.LOOSEPLAIN]}|${g[d.XRANGEPLAIN]})`,!0);F.comparatorTrimReplace="$1$2$3";m("HYPHENRANGE",`^\\s*(${g[d.XRANGEPLAIN]})\\s+-\\s+(${g[d.XRANGEPLAIN]})\\s*$`);m("HYPHENRANGELOOSE",`^\\s*(${g[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[d.XRANGEPLAINLOOSE]})\\s*$`);m("STAR","(<|>)?=?\\s*\\*");m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Je=k((oi,We)=>{var bn=Object.freeze({loose:!0}),wn=Object.freeze({}),Tn=s=>s?typeof s!="object"?bn:s:wn;We.exports=Tn});var et=k((ri,Ke)=>{var Qe=/^[0-9]+$/,Ze=(s,t)=>{let e=Qe.test(s),n=Qe.test(t);return e&&n&&(s=+s,t=+t),s===t?0:e&&!n?-1:n&&!e?1:s<t?-1:1},En=(s,t)=>Ze(t,s);Ke.exports={compareIdentifiers:Ze,rcompareIdentifiers:En}});var me=k((ai,st)=>{var ge=Ie(),{MAX_LENGTH:tt,MAX_SAFE_INTEGER:de}=Ae(),{safeRe:nt,safeSrc:it,t:pe}=Se(),yn=Je(),{compareIdentifiers:V}=et(),$e=class s{constructor(t,e){if(e=yn(e),t instanceof s){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>tt)throw new TypeError(`version is longer than ${tt} characters`);ge("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;let n=t.trim().match(e.loose?nt[pe.LOOSE]:nt[pe.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>de||this.major<0)throw new TypeError("Invalid major version");if(this.minor>de||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>de||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let o=+i;if(o>=0&&o<de)return o}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(ge("SemVer.compare",this.version,this.options,t),!(t instanceof s)){if(typeof t=="string"&&t===this.version)return 0;t=new s(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof s||(t=new s(t,this.options)),V(this.major,t.major)||V(this.minor,t.minor)||V(this.patch,t.patch)}comparePre(t){if(t instanceof s||(t=new s(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{let n=this.prerelease[e],i=t.prerelease[e];if(ge("prerelease compare",e,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return V(n,i)}while(++e)}compareBuild(t){t instanceof s||(t=new s(t,this.options));let e=0;do{let n=this.build[e],i=t.build[e];if(ge("build compare",e,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return V(n,i)}while(++e)}inc(t,e,n){if(t.startsWith("pre")){if(!e&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(e){let i=new RegExp(`^${this.options.loose?it[pe.PRERELEASELOOSE]:it[pe.PRERELEASE]}$`),o=`-${e}`.match(i);if(!o||o[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,n),this.inc("pre",e,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,n),this.inc("pre",e,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(e===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(e){let o=[e,i];n===!1&&(o=[e]),V(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};st.exports=$e});var ke=k((li,rt)=>{var ot=me(),vn=(s,t,e)=>new ot(s,e).compare(new ot(t,e));rt.exports=vn});var ut=k((ui,lt)=>{var at=me(),Pn=(s,t,e=!1)=>{if(s instanceof at)return s;try{return new at(s,t)}catch(n){if(!e)return null;throw n}};lt.exports=Pn});var De=k((ci,ct)=>{var Rn=me(),Nn=ut(),{safeRe:he,t:fe}=Se(),In=(s,t)=>{if(s instanceof Rn)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;t=t||{};let e=null;if(!t.rtl)e=s.match(t.includePrerelease?he[fe.COERCEFULL]:he[fe.COERCE]);else{let u=t.includePrerelease?he[fe.COERCERTLFULL]:he[fe.COERCERTL],l;for(;(l=u.exec(s))&&(!e||e.index+e[0].length!==s.length);)(!e||l.index+l[0].length!==e.index+e[0].length)&&(e=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(e===null)return null;let n=e[2],i=e[3]||"0",o=e[4]||"0",r=t.includePrerelease&&e[5]?`-${e[5]}`:"",a=t.includePrerelease&&e[6]?`+${e[6]}`:"";return Nn(`${n}.${i}.${o}${r}${a}`,t)};ct.exports=In});var Gt=k(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var P=require("obsidian"),Be="YYYY-MM-DD",_e="gggg-[W]ww",St="YYYY-MM",$t="YYYY-[Q]Q",kt="YYYY";function te(s){var e,n;let t=window.app.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e[s])==null?void 0:n.enabled)}function ne(){var s,t,e,n;try{let{internalPlugins:i,plugins:o}=window.app;if(te("daily")){let{format:l,folder:c,template:p}=((t=(s=o.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:t.daily)||{};return{format:l||Be,folder:(c==null?void 0:c.trim())||"",template:(p==null?void 0:p.trim())||""}}let{folder:r,format:a,template:u}=((n=(e=i.getPluginById("daily-notes"))==null?void 0:e.instance)==null?void 0:n.options)||{};return{format:a||Be,folder:(r==null?void 0:r.trim())||"",template:(u==null?void 0:u.trim())||""}}catch(i){console.info("No custom daily note settings found!",i)}}function ie(){var s,t,e,n,i,o,r;try{let a=window.app.plugins,u=(s=a.getPlugin("calendar"))==null?void 0:s.options,l=(e=(t=a.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.weekly;if(te("weekly"))return{format:l.format||_e,folder:((n=l.folder)==null?void 0:n.trim())||"",template:((i=l.template)==null?void 0:i.trim())||""};let c=u||{};return{format:c.weeklyNoteFormat||_e,folder:((o=c.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((r=c.weeklyNoteTemplate)==null?void 0:r.trim())||""}}catch(a){console.info("No custom weekly note settings found!",a)}}function se(){var t,e,n,i;let s=window.app.plugins;try{let o=te("monthly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.monthly)||{};return{format:o.format||St,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function oe(){var t,e,n,i;let s=window.app.plugins;try{let o=te("quarterly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.quarterly)||{};return{format:o.format||$t,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function re(){var t,e,n,i;let s=window.app.plugins;try{let o=te("yearly")&&((e=(t=s.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.yearly)||{};return{format:o.format||kt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function Dt(...s){let t=[];for(let n=0,i=s.length;n<i;n++)t=t.concat(s[n].split("/"));let e=[];for(let n=0,i=t.length;n<i;n++){let o=t[n];!o||o==="."||e.push(o)}return t[0]===""&&e.unshift(""),e.join("/")}function kn(s){let t=s.substring(s.lastIndexOf("/")+1);return t.lastIndexOf(".")!=-1&&(t=t.substring(0,t.lastIndexOf("."))),t}async function Dn(s){let t=s.replace(/\\/g,"/").split("/");if(t.pop(),t.length){let e=Dt(...t);window.app.vault.getAbstractFileByPath(e)||await window.app.vault.createFolder(e)}}async function ae(s,t){t.endsWith(".md")||(t+=".md");let e=P.normalizePath(Dt(s,t));return await Dn(e),e}async function z(s){let{metadataCache:t,vault:e}=window.app,n=P.normalizePath(s);if(n==="/")return Promise.resolve(["",null]);try{let i=t.getFirstLinkpathDest(n,""),o=await e.cachedRead(i),r=window.app.foldManager.load(i);return[o,r]}catch(i){return console.error(`Failed to read the daily note template '${n}'`,i),new P.Notice("Failed to read the daily note template"),["",null]}}function S(s,t="day"){let e=s.clone().startOf(t).format();return`${t}-${e}`}function Ft(s){return s.replace(/\[[^\]]*\]/g,"")}function Fn(s,t){if(t==="week"){let e=Ft(s);return/w{1,2}/i.test(e)&&(/M{1,4}/.test(e)||/D{1,4}/.test(e))}return!1}function q(s,t){return Ot(s.basename,t)}function On(s,t){return Ot(kn(s),t)}function Ot(s,t){let n={day:ne,week:ie,month:se,quarter:oe,year:re}[t]().format.split("/").pop(),i=window.moment(s,n,!0);if(!i.isValid())return null;if(Fn(n,t)&&t==="week"){let o=Ft(n);if(/w{1,2}/i.test(o))return window.moment(s,n.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return i}var He=class extends Error{};async function xt(s){let t=window.app,{vault:e}=t,n=window.moment,{template:i,format:o,folder:r}=ne(),[a,u]=await z(i),l=s.format(o),c=await ae(r,l);try{let p=await e.create(c,a.replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,n().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(E,f,y,v,T,w)=>{let N=n(),$=s.clone().set({hour:N.get("hour"),minute:N.get("minute"),second:N.get("second")});return y&&$.add(parseInt(v,10),T),w?$.format(w.substring(1).trim()):$.format(o)}).replace(/{{\s*yesterday\s*}}/gi,s.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,s.clone().add(1,"d").format(o)));return t.foldManager.save(p,u),p}catch(p){console.error(`Failed to create file: '${c}'`,p),new P.Notice("Unable to create new file.")}}function xn(s,t){var e;return(e=t[S(s,"day")])!=null?e:null}function Mn(){let{vault:s}=window.app,{folder:t}=ne(),e=s.getAbstractFileByPath(P.normalizePath(t));if(!e)throw new He("Failed to find daily notes folder");let n={};return P.Vault.recurseChildren(e,i=>{if(i instanceof P.TFile){let o=q(i,"day");if(o){let r=S(o,"day");n[r]=i}}}),n}var Ve=class extends Error{};function Bn(){let{moment:s}=window,t=s.localeData()._week.dow,e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;t;)e.push(e.shift()),t--;return e}function _n(s){return Bn().indexOf(s.toLowerCase())}async function Mt(s){let{vault:t}=window.app,{template:e,format:n,folder:i}=ie(),[o,r]=await z(e),a=s.format(n),u=await ae(i,a);try{let l=await t.create(u,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(c,p,E,f,y,v)=>{let T=window.moment(),w=s.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return E&&w.add(parseInt(f,10),y),v?w.format(v.substring(1).trim()):w.format(n)}).replace(/{{\s*title\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(c,p,E)=>{let f=_n(p);return s.weekday(f).format(E.trim())}));return window.app.foldManager.save(l,r),l}catch(l){console.error(`Failed to create file: '${u}'`,l),new P.Notice("Unable to create new file.")}}function Hn(s,t){var e;return(e=t[S(s,"week")])!=null?e:null}function Vn(){let s={};if(!_t())return s;let{vault:t}=window.app,{folder:e}=ie(),n=t.getAbstractFileByPath(P.normalizePath(e));if(!n)throw new Ve("Failed to find weekly notes folder");return P.Vault.recurseChildren(n,i=>{if(i instanceof P.TFile){let o=q(i,"week");if(o){let r=S(o,"week");s[r]=i}}}),s}var Ue=class extends Error{};async function Bt(s){let{vault:t}=window.app,{template:e,format:n,folder:i}=se(),[o,r]=await z(e),a=s.format(n),u=await ae(i,a);try{let l=await t.create(u,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(c,p,E,f,y,v)=>{let T=window.moment(),w=s.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return E&&w.add(parseInt(f,10),y),v?w.format(v.substring(1).trim()):w.format(n)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,r),l}catch(l){console.error(`Failed to create file: '${u}'`,l),new P.Notice("Unable to create new file.")}}function Un(s,t){var e;return(e=t[S(s,"month")])!=null?e:null}function Gn(){let s={};if(!Ht())return s;let{vault:t}=window.app,{folder:e}=se(),n=t.getAbstractFileByPath(P.normalizePath(e));if(!n)throw new Ue("Failed to find monthly notes folder");return P.Vault.recurseChildren(n,i=>{if(i instanceof P.TFile){let o=q(i,"month");if(o){let r=S(o,"month");s[r]=i}}}),s}var Ge=class extends Error{};async function jn(s){let{vault:t}=window.app,{template:e,format:n,folder:i}=oe(),[o,r]=await z(e),a=s.format(n),u=await ae(i,a);try{let l=await t.create(u,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(c,p,E,f,y,v)=>{let T=window.moment(),w=s.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return E&&w.add(parseInt(f,10),y),v?w.format(v.substring(1).trim()):w.format(n)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,r),l}catch(l){console.error(`Failed to create file: '${u}'`,l),new P.Notice("Unable to create new file.")}}function zn(s,t){var e;return(e=t[S(s,"quarter")])!=null?e:null}function qn(){let s={};if(!Vt())return s;let{vault:t}=window.app,{folder:e}=oe(),n=t.getAbstractFileByPath(P.normalizePath(e));if(!n)throw new Ge("Failed to find quarterly notes folder");return P.Vault.recurseChildren(n,i=>{if(i instanceof P.TFile){let o=q(i,"quarter");if(o){let r=S(o,"quarter");s[r]=i}}}),s}var je=class extends Error{};async function Xn(s){let{vault:t}=window.app,{template:e,format:n,folder:i}=re(),[o,r]=await z(e),a=s.format(n),u=await ae(i,a);try{let l=await t.create(u,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(c,p,E,f,y,v)=>{let T=window.moment(),w=s.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return E&&w.add(parseInt(f,10),y),v?w.format(v.substring(1).trim()):w.format(n)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,r),l}catch(l){console.error(`Failed to create file: '${u}'`,l),new P.Notice("Unable to create new file.")}}function Yn(s,t){var e;return(e=t[S(s,"year")])!=null?e:null}function Wn(){let s={};if(!Ut())return s;let{vault:t}=window.app,{folder:e}=re(),n=t.getAbstractFileByPath(P.normalizePath(e));if(!n)throw new je("Failed to find yearly notes folder");return P.Vault.recurseChildren(n,i=>{if(i instanceof P.TFile){let o=q(i,"year");if(o){let r=S(o,"year");s[r]=i}}}),s}function Jn(){var n,i;let{app:s}=window,t=s.internalPlugins.plugins["daily-notes"];if(t&&t.enabled)return!0;let e=s.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n.daily)==null?void 0:i.enabled)}function _t(){var e,n;let{app:s}=window;if(s.plugins.getPlugin("calendar"))return!0;let t=s.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.weekly)==null?void 0:n.enabled)}function Ht(){var e,n;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.monthly)==null?void 0:n.enabled)}function Vt(){var e,n;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.quarterly)==null?void 0:n.enabled)}function Ut(){var e,n;let{app:s}=window,t=s.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.yearly)==null?void 0:n.enabled)}function Qn(s){let t={day:ne,week:ie,month:se,quarter:oe,year:re}[s];return t()}function Zn(s,t){return{day:xt,month:Bt,week:Mt}[s](t)}b.DEFAULT_DAILY_NOTE_FORMAT=Be;b.DEFAULT_MONTHLY_NOTE_FORMAT=St;b.DEFAULT_QUARTERLY_NOTE_FORMAT=$t;b.DEFAULT_WEEKLY_NOTE_FORMAT=_e;b.DEFAULT_YEARLY_NOTE_FORMAT=kt;b.appHasDailyNotesPluginLoaded=Jn;b.appHasMonthlyNotesPluginLoaded=Ht;b.appHasQuarterlyNotesPluginLoaded=Vt;b.appHasWeeklyNotesPluginLoaded=_t;b.appHasYearlyNotesPluginLoaded=Ut;b.createDailyNote=xt;b.createMonthlyNote=Bt;b.createPeriodicNote=Zn;b.createQuarterlyNote=jn;b.createWeeklyNote=Mt;b.createYearlyNote=Xn;b.getAllDailyNotes=Mn;b.getAllMonthlyNotes=Gn;b.getAllQuarterlyNotes=qn;b.getAllWeeklyNotes=Vn;b.getAllYearlyNotes=Wn;b.getDailyNote=xn;b.getDailyNoteSettings=ne;b.getDateFromFile=q;b.getDateFromPath=On;b.getDateUID=S;b.getMonthlyNote=Un;b.getMonthlyNoteSettings=se;b.getPeriodicNoteSettings=Qn;b.getQuarterlyNote=zn;b.getQuarterlyNoteSettings=oe;b.getTemplateInfo=z;b.getWeeklyNote=Hn;b.getWeeklyNoteSettings=ie;b.getYearlyNote=Yn;b.getYearlyNoteSettings=re});var Kn={};Zt(Kn,{default:()=>Re});module.exports=en(Kn);var qt=require("obsidian");var O=require("obsidian");var L=class extends Error{constructor(e,n,i,o){let r=Math.ceil((i-Math.floor(Date.now()/1e3))/60);super(`GitHub API rate limit exceeded. Reset in ${r} minutes.`);this.limit=e;this.remaining=n;this.reset=i;this.requestUrl=o}getMinutesToReset(){return Math.ceil((this.reset-Math.floor(Date.now()/1e3))/60)}},D=class extends Error{constructor(t){var n,i;super(`GitHub API error ${t}: ${t.message}`),this.message=t.message;let e=t;this.status=(n=e.status)!=null?n:400,this.headers=(i=e.headers)!=null?i:{},this.name="GitHubResponseError"}};var M=require("obsidian");var An=ke(),gt=De();var dt=["ghp_","github_pat_"],Ln=/^(gh[ps]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})$/,Fe=async(s,t=["repo","public_repo","metadata=read"],e=!1)=>{var o,r,a,u,l,c,p,E,f,y,v;let n=dt.some(T=>s.toLowerCase().startsWith(T.toLowerCase())),i=Ln.test(s);if(!n||!i)return{validToken:!1,currentScopes:[],acceptedScopes:[],acceptedPermissions:[],expirationDate:null,rateLimit:{limit:0,remaining:0,reset:0,resource:"",used:0},error:{type:n?"invalid_format":"invalid_prefix",message:"Invalid token format",details:{validPrefixes:dt}}};try{let T=Date.now()%1e3,w=`user${T}/repo${T%100}`;throw await be({url:`https://api.github.com/repos/${w}`,headers:{Authorization:`Token ${s}`,Accept:"application/vnd.github.v3+json"}}),new Error("Expected request to fail")}catch(T){if(!(T instanceof D))throw T;let w=T.headers;if(!w)throw new Error("No headers in GitHub response");e&&console.log("GitHub Headers:",w);let N=w["github-authentication-token-expiration"],$=N?new Date(N):null,ue=$&&!Number.isNaN($.getTime())?$.toISOString():null,I={validToken:!1,currentScopes:(r=(o=w["x-oauth-scopes"])==null?void 0:o.split(", "))!=null?r:[],acceptedScopes:(u=(a=w["x-accepted-oauth-scopes"])==null?void 0:a.split(", "))!=null?u:[],acceptedPermissions:(c=(l=w["x-accepted-github-permissions"])==null?void 0:l.split(", "))!=null?c:[],expirationDate:ue,rateLimit:{limit:Number.parseInt((p=w["x-ratelimit-limit"])!=null?p:"0"),remaining:Number.parseInt((E=w["x-ratelimit-remaining"])!=null?E:"0"),reset:Number.parseInt((f=w["x-ratelimit-reset"])!=null?f:"0"),resource:(y=w["x-ratelimit-resource"])!=null?y:"",used:Number.parseInt((v=w["x-ratelimit-used"])!=null?v:"0")},error:{type:"none",message:"No error",details:{}}};return I.expirationDate&&new Date(I.expirationDate)<new Date?(I.error={type:"expired",message:"Token has expired",details:{expirationDate:I.expirationDate}},I):I.currentScopes.some(Ne=>t.includes(Ne))||I.acceptedPermissions.some(Ne=>t.includes(Ne))?(I.validToken=T.status===404,I):(I.error={type:"insufficient_scope",message:"Token lacks required scopes. Check documentation for requirements.",details:{currentScopes:[...I.acceptedScopes,...I.acceptedPermissions]}},I)}},Oe=async(s,t=!0,e="")=>{let n=`https://api.github.com/repos/${s}`;try{let i=await be({url:n,headers:e?{Authorization:`Token ${e}`}:{}});return(await JSON.parse(i)).private}catch(i){if(i instanceof L)throw i;return t&&console.log("error in isPrivateRepo",n,i),!1}},pt=async(s,t=!0,e="")=>{let n=`https://api.github.com/repos/${s}/releases`;try{let i=await be({url:`${n}?per_page=100`,headers:e?{Authorization:`Token ${e}`}:{}});return(await JSON.parse(i)).map(r=>({version:r.tag_name,prerelease:r.prerelease}))}catch(i){if(i instanceof L||i instanceof D)throw i;return t&&console.log("Error in fetchReleaseVersions",n,i),null}},X=async(s,t,e=!0,n=!1,i="")=>{try{let o=s.assets.find(u=>u.name===t);if(!o)return null;let r={Accept:"application/octet-stream"};(n&&i||i)&&(r.Authorization=`Token ${i}`);let a=await(0,M.request)({url:o.url,headers:r});return a==="Not Found"||a==='{"error":"Not Found"}'?null:a}catch(o){if(o instanceof L)throw o;return e&&console.log("error in grabReleaseFileFromRepository",URL,o),null}},mt=async(s=!0)=>{let t="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-plugins.json";try{let e=await(0,M.request)({url:t});return e==="404: Not Found"?null:await JSON.parse(e)}catch(e){return s&&console.log("error in grabCommmunityPluginList",e),null}},ht=async(s=!0)=>{let t="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-css-themes.json";try{let e=await(0,M.request)({url:t});return e==="404: Not Found"?null:await JSON.parse(e)}catch(e){return s&&console.log("error in grabCommmunityThemesList",e),null}},U=async(s,t=!1,e=!1)=>{let n=`https://raw.githubusercontent.com/${s}/HEAD/theme${t?"-beta":""}.css`;try{let i=await(0,M.request)({url:n});return i==="404: Not Found"?null:i}catch(i){return e&&console.log("error in grabCommmunityThemeCssFile",i),null}},ft=async(s,t=!0)=>{let e=`https://raw.githubusercontent.com/${s}/HEAD/manifest.json`;try{let n=await(0,M.request)({url:e});return n==="404: Not Found"?null:n}catch(n){return t&&console.log("error in grabCommmunityThemeManifestFile",n),null}},Cn=s=>{let t=0;for(let e=0;e<s.length;e++)t+=s.charCodeAt(e);return t},Y=s=>Cn(s).toString(),W=async(s,t,e)=>{let n=await U(s,t,e);return n?Y(n):"0"},Sn=async(s,t,e=!0)=>{let n=`https://api.github.com/repos/${s}/commits?path=${t}&page=1&per_page=1`;try{let i=await(0,M.request)({url:n});return i==="404: Not Found"?null:JSON.parse(i)}catch(i){return e&&console.log("error in grabLastCommitInfoForAFile",i),null}},bt=async(s,t)=>{var n;let e=await Sn(s,t);return e&&e.length>0&&((n=e[0].commit.committer)!=null&&n.date)?e[0].commit.committer.date:""},xe=async(s,t,e=!1,n=!1,i=!1,o)=>{var r;try{let a=t&&t!=="latest"?`https://api.github.com/repos/${s}/releases/tags/${t}`:`https://api.github.com/repos/${s}/releases`,u={Accept:"application/vnd.github.v3+json"};(i&&o||o)&&(u.Authorization=`Token ${o}`);let l=await be({url:a,headers:u});if(l==="404: Not Found")return null;let c=t&&t!=="latest"?[JSON.parse(l)]:JSON.parse(l);return n&&console.log(`grabReleaseFromRepository for ${s}:`,c),(r=c.sort((p,E)=>{let f=gt(p.tag_name,{includePrerelease:!0,loose:!0}),y=gt(E.tag_name,{includePrerelease:!0,loose:!0});return An(y,f)}).filter(p=>e||!p.prerelease)[0])!=null?r:null}catch(a){throw n&&console.log(`Error in grabReleaseFromRepository for ${s}:`,a),a}},be=async(s,t)=>{let e=0,n=0,i=0;try{return await(0,M.request)(s)}catch(o){let r=new D(o),a=r.headers;if(a&&(e=Number.parseInt(a["x-ratelimit-limit"]),n=Number.parseInt(a["x-ratelimit-remaining"]),i=Number.parseInt(a["x-ratelimit-reset"])),r.status===403&&n===0){let u=new L(e,n,i,s.url);throw t&&console.error(`BRAT
GitHub API rate limit exceeded:`,`
Request: ${u.requestUrl}`,`
Rate limits - Remaining: ${u.remaining}`,`
Reset in: ${u.getMinutesToReset()} minutes`),u}throw t&&console.log("GitHub request failed:",o),r}};var Me={pluginList:[],pluginSubListFrozenVersion:[],themesList:[],updateAtStartup:!0,updateThemesAtStartup:!0,enableAfterInstall:!0,loggingEnabled:!1,loggingPath:"BRAT-log",loggingVerboseEnabled:!1,debuggingMode:!1,notificationsEnabled:!0,personalAccessToken:""};function wt(s,t,e="latest",n=""){let i=!1;s.settings.pluginList.contains(t)||(s.settings.pluginList.unshift(t),i=!0),s.settings.pluginSubListFrozenVersion.filter(o=>o.repo===t).length===0&&(s.settings.pluginSubListFrozenVersion.unshift({repo:t,version:e,token:n||void 0}),i=!0),i&&s.saveSettings()}function Tt(s,t){return s.settings.pluginList.contains(t)}function Et(s,t,e){let n={repo:t,lastUpdate:Y(e)};s.settings.themesList.unshift(n),s.saveSettings()}function yt(s,t){return!!s.settings.themesList.find(n=>n.repo===t)}function vt(s,t,e){for(let n of s.settings.themesList)n.repo===t&&(n.lastUpdate=e,s.saveSettings())}var C=require("obsidian");function J(s,t){let e=new DocumentFragment,n=document.createElement("a");if(n.textContent=s,n.href=`https://github.com/${s}`,n.target="_blank",e.appendChild(n),t){let i=document.createTextNode(t);e.appendChild(i)}return e}function Pt({prependText:s,url:t,text:e,appendText:n}){let i=new DocumentFragment,o=document.createElement("a");if(o.textContent=e,o.href=t,s){let r=document.createTextNode(s);i.appendChild(r)}if(i.appendChild(o),n){let r=document.createTextNode(n);i.appendChild(r)}return i}var we=require("obsidian");function h(s,t,e=10,n){if(!s.settings.notificationsEnabled)return;let i=n?we.Platform.isDesktop?"(click=dismiss, right-click=Info)":"(click=dismiss)":"",o=new we.Notice(`BRAT
${t}
${i}`,e*1e3);n&&(o.noticeEl.oncontextmenu=()=>{n()})}var G=(s,t=!0)=>{let e=s.createEl("div");e.style.float="right",t?(e.style.padding="15px",e.style.paddingLeft="15px",e.style.paddingRight="15px",e.style.marginLeft="15px"):(e.style.padding="10px",e.style.paddingLeft="15px",e.style.paddingRight="15px");let n=e.createDiv("coffee");n.addClass("ex-twitter-span"),n.style.paddingLeft="10px";let i=n.createDiv();i.innerText="Learn more about my work at:",n.appendChild(i);let o=n.createEl("a",{href:"https://tfthacker.com"});return o.innerText="https://tfthacker.com",e};var Rt=require("obsidian"),Te=class extends Rt.SuggestModal{constructor(t,e,n,i,o){super(t),this.versions=n,this.selected=i,this.onChoose=o,this.setTitle("Select a version"),this.setPlaceholder(`Type to search for a version for ${e}`),this.setInstructions([{command:"\u2191\u2193",purpose:"Navigate versions"},{command:"\u21B5",purpose:"Select version"},{command:"esc",purpose:"Dismiss modal"}])}getSuggestions(t){let e=t.toLowerCase();return this.versions.filter(n=>n.version.toLowerCase().contains(e))}renderSuggestion(t,e){e.createEl("div",{text:`${t.version} ${t.prerelease?"(Prerelease)":""}`})}onChooseSuggestion(t){this.onChoose(t.version)}onNoSuggestion(){this.onChoose(this.selected?this.selected:""),this.close()}};var B=class extends C.Modal{constructor(e,n,i=!1,o=!1,r="",a="",u=""){super(e.app);this.versionSetting=null;this.addPluginButton=null;this.cancelButton=null;this.plugin=e,this.betaPlugins=n,this.address=r,this.version=a,this.privateApiKey=u,this.openSettingsTabAfterwards=i,this.updateVersion=o,this.enableAfterInstall=e.settings.enableAfterInstall}async submitForm(){if(this.address==="")return;let e=this.address.replace("https://github.com/","");e.endsWith(".git")&&(e=e.slice(0,-4));let n=this.plugin.settings.pluginSubListFrozenVersion.find(o=>o.repo===e);if(n){n.version=this.version,n.token=this.privateApiKey||"",await this.plugin.saveSettings(),await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!0,this.enableAfterInstall,this.privateApiKey)&&this.close();return}if(!this.version&&Tt(this.plugin,e)){h(this.plugin,"This plugin is already in the list for beta testing",10);return}await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!1,this.enableAfterInstall,this.privateApiKey)&&this.close()}updateVersionDropdown(e,n,i=""){e.clear(),n.length<20||C.Platform.isMobile?e.addDropdown(r=>{r.addOption("","Select a version"),r.addOption("latest","Latest version");for(let a of n)r.addOption(a.version,`${a.version} ${a.prerelease?"(Prerelease)":""}`);r.setValue(i),r.onChange(a=>{this.version=a,this.updateAddButtonState()}),r.selectEl.addClass("brat-version-selector"),r.selectEl.style.width="100%"}):e.addButton(r=>{r.setButtonText(i==="latest"?"Latest version":i||"Select a version...").setClass("brat-version-selector").setClass("button").onClick(a=>{a.preventDefault();let l=[{version:"latest",prerelease:!1},...n];new Te(this.app,this.address,l,i,p=>{this.version=p,r.setButtonText(p==="latest"?"Latest version":p||"Select a version..."),this.updateAddButtonState()}).open()})})}updateAddButtonState(){this.addPluginButton&&this.addPluginButton.setDisabled(this.version==="")}onOpen(){let e=this.contentEl.createEl("h4");this.address?(e.appendText("Change plugin version: "),e.appendChild(J(this.address))):e.setText("Github repository for beta plugin:"),this.contentEl.createEl("form",{},n=>{if(n.addClass("brat-modal"),!this.address||!this.updateVersion){let r=new C.Setting(n).setClass("repository-setting"),a=r.settingEl.createDiv("validation-status");a.style.color="var(--text-error)",a.style.marginTop="6px",a.style.fontSize="0.8em",r.then(u=>{u.addText(l=>{l.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name)"),l.setValue(this.address),l.onChange(c=>{var p,E;this.address=c.trim(),this.version!==""&&(!this.address||!this.isGitHubRepositoryMatch(this.address))&&this.versionSetting&&(this.updateVersionDropdown(this.versionSetting,[]),this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),l.inputEl.classList.remove("valid-repository"),l.inputEl.classList.remove("invalid-repository")),this.version||(this.isGitHubRepositoryMatch(this.address)?(p=this.addPluginButton)==null||p.setDisabled(!1):(E=this.addPluginButton)==null||E.setDisabled(!0))}),l.inputEl.addEventListener("keydown",async c=>{var p,E,f;c.key==="Enter"&&(this.address&&(this.updateVersion&&this.version!==""||!this.updateVersion)&&(c.preventDefault(),(p=this.addPluginButton)==null||p.setDisabled(!0),(E=this.cancelButton)==null||E.setDisabled(!0),(f=this.versionSetting)==null||f.setDisabled(!0),this.submitForm()),await this.updateRepositoryVersionInfo(this.version,l))}),this.updateVersion&&l.inputEl.addEventListener("blur",async()=>{await this.updateRepositoryVersionInfo(this.version,l,a)}),l.inputEl.style.width="100%"})})}new C.Setting(n).setClass("api-setting").addText(r=>{r.setPlaceholder("GitHub API key for private repository (optional)").setValue(this.privateApiKey).onChange(async a=>{this.privateApiKey=a.trim(),this.address&&await this.updateRepositoryVersionInfo(this.version,r)}),r.inputEl.type="password",r.inputEl.style.width="100%"}),this.versionSetting=new C.Setting(n).setClass("version-setting").setClass("disabled-setting"),this.updateVersionDropdown(this.versionSetting,[],this.version),this.versionSetting.setDisabled(!0),n.createDiv("modal-button-container",r=>{var a;r.createEl("label",{cls:"mod-checkbox"},u=>{let l=u.createEl("input",{attr:{tabindex:-1},type:"checkbox"});l.checked=this.enableAfterInstall,l.addEventListener("click",()=>{this.enableAfterInstall=l.checked}),u.appendText("Enable after installing the plugin")}),this.cancelButton=new C.ButtonComponent(r).setButtonText("Never mind").setClass("mod-cancel").onClick(u=>{this.close()}),this.addPluginButton=new C.ButtonComponent(r).setButtonText(this.updateVersion&&this.address?"Change version":"Add plugin").setCta().onClick(u=>{var l,c,p,E;u.preventDefault(),this.address!==""&&(this.updateVersion&&this.version!==""||!this.updateVersion)&&((l=this.addPluginButton)==null||l.setDisabled(!0),(c=this.addPluginButton)==null||c.setButtonText("Installing \u2026"),(p=this.cancelButton)==null||p.setDisabled(!0),(E=this.versionSetting)==null||E.setDisabled(!0),this.submitForm())}),(this.updateVersion||this.address==="")&&((a=this.addPluginButton)==null||a.setDisabled(!0))});let i=n.createDiv();i.style.borderTop="1px solid #ccc",i.style.marginTop="30px";let o=i.createSpan();o.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",o.style.fontStyle="italic",i.appendChild(o),G(i,!1),window.setTimeout(()=>{let r=n.querySelectorAll(".brat-modal .setting-item-info");for(let a of Array.from(r))a.remove()},50),n.addEventListener("submit",r=>{var a;r.preventDefault(),this.address!==""&&(this.updateVersion&&this.version!==""||!this.updateVersion)&&((a=this.addPluginButton)==null||a.setDisabled(!0),this.submitForm())})}),this.address&&window.setTimeout(async()=>{await this.updateRepositoryVersionInfo(this.version)},100)}async updateRepositoryVersionInfo(e="",n,i){var r,a;if(this.plugin.settings.debuggingMode&&console.log(`[BRAT] Updating version dropdown for ${this.address} with selected version ${e}`),!this.address){i&&i.setText("Repository address is required.");return}this.versionSetting&&this.updateVersion&&this.updateVersionDropdown(this.versionSetting,[],e);let o=this.address.replace("https://github.com/","");o.endsWith(".git")&&(o=o.slice(0,-4));try{let u=await pt(o,this.plugin.settings.debuggingMode,this.privateApiKey||this.plugin.settings.personalAccessToken);u&&u.length>0?(n==null||n.inputEl.classList.remove("invalid-repository"),n==null||n.inputEl.classList.add("valid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.remove("disabled-setting"),this.versionSetting.setDisabled(!1),this.updateVersionDropdown(this.versionSetting,u,e))):(n==null||n.inputEl.classList.remove("valid-repository"),n==null||n.inputEl.classList.add("invalid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),(r=this.addPluginButton)==null||r.setDisabled(!0)))}catch(u){if(u instanceof L&&(n==null||n.inputEl.classList.remove("valid-repository"),n==null||n.inputEl.classList.add("validation-error"),i==null||i.setText(`GitHub API rate limit exceeded. Try again in ${u.getMinutesToReset()} minutes.`),this.versionSetting&&(this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),(a=this.addPluginButton)==null||a.setDisabled(!0)),h(this.plugin,`${u.message} Consider adding a personal access token in BRAT settings for higher limits. See documentation for details.`,20,()=>{window.open("https://github.com/TfTHacker/obsidian42-brat/blob/main/BRAT-DEVELOPER-GUIDE.md#github-api-rate-limits")})),u instanceof D){let l=u;switch(l.status){case 404:i==null||i.setText("Repository not found.");break;case 403:i==null||i.setText("Access denied. Check your personal access token.");break;default:i==null||i.setText(`Error: ${l.message}`);break}h(this.plugin,`${l.message} `,20)}}}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.open(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}isGitHubRepositoryMatch(e){let n=e.trim().replace(/\.git$/,"").toLowerCase();return/^(?:https:\/\/github\.com\/)?([a-zA-Z0-9._-]+)\/([a-zA-Z0-9._-]+)$/.test(n)}};var Nt=require("obsidian");async function Ee(){try{let s=await(0,Nt.requestUrl)(`https://obsidian.md/?${Math.random()}`);return s.status>=200&&s.status<300}catch(s){return!1}}var It=ke(),ye=De(),Q=class{constructor(t){this.plugin=t}displayAddNewPluginModal(t=!1,e=!1,n="",i="",o=""){new B(this.plugin,this,t,e,n,i,o).open()}async validateRepository(t,e=!1,n=!1,i="",o=""){try{let a=await Oe(t,this.plugin.settings.debuggingMode,o||this.plugin.settings.personalAccessToken),u=await xe(t,i,e,this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken);if(!u)return n&&(h(this.plugin,`${t}
This does not seem to be an obsidian plugin with valid releases, as there are no releases available.`,15),console.error("BRAT: validateRepository",t,e,n)),null;let l=await X(u,"manifest.json",this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken);if(!l)return n&&(h(this.plugin,`${t}
This does not seem to be an obsidian plugin, as there is no manifest.json file.`,15),console.error("BRAT: validateRepository",t,e,n)),null;let c=JSON.parse(l);if(!("id"in c))return n&&h(this.plugin,`${t}
The plugin id attribute for the release is missing from the manifest file`,15),null;if(!("version"in c))return n&&h(this.plugin,`${t}
The version attribute for the release is missing from the manifest file`,15),null;let p=ye(u.tag_name,{includePrerelease:!0,loose:!0}),E=ye(c.version,{includePrerelease:!0,loose:!0});return It(p,E)!==0&&(n&&h(this.plugin,`${t}
Version mismatch detected:
Release tag version: ${u.tag_name}
Manifest version: ${c.version}

The release tag version will be used to ensure consistency.`,15),c.version=p.version),c}catch(a){if(a instanceof L){let u=`GitHub API rate limit exceeded. Reset in ${a.getMinutesToReset()} minutes.`;throw n&&h(this.plugin,u,15),console.error(`BRAT: validateRepository ${a}`),h(this.plugin,`${a.message} Consider adding a personal access token in BRAT settings for higher limits. See documentation for details.`,20,()=>{window.open("https://github.com/TfTHacker/obsidian42-brat/blob/main/BRAT-DEVELOPER-GUIDE.md#github-api-rate-limits")}),a}if(a instanceof D)throw n&&(a.status===401?h(this.plugin,`${t}
GitHub API Authentication error. Please verify that your personal access token is valid and set correctly.`,15):h(this.plugin,`${t}
GitHub API error ${a.status}: ${a.message}`,15)),console.error(`BRAT: validateRepository ${a}`),a;return n&&h(this.plugin,`${t}
Unspecified error encountered: ${a}, verify debug for more information.`,15),null}}async getAllReleaseFiles(t,e,n,i="",o=""){let r=await Oe(t,this.plugin.settings.debuggingMode,o),a=await xe(t,i,n,this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken);if(!a)return Promise.reject("No release found");let u=n||i!=="";return console.log({reallyGetManifestOrNot:u,version:a.tag_name}),{mainJs:await X(a,"main.js",this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken),manifest:u?await X(a,"manifest.json",this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken):"",styles:await X(a,"styles.css",this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken)}}async writeReleaseFilesToPluginFolder(t,e){var o,r;let n=`${(0,O.normalizePath)(`${this.plugin.app.vault.configDir}/plugins/${t}`)}/`,{adapter:i}=this.plugin.app.vault;await i.exists(n)||await i.mkdir(n),await i.write(`${n}main.js`,(o=e.mainJs)!=null?o:""),await i.write(`${n}manifest.json`,(r=e.manifest)!=null?r:""),e.styles&&await i.write(`${n}styles.css`,e.styles)}async addPlugin(t,e=!1,n=!1,i=!1,o="",r=!1,a=this.plugin.settings.enableAfterInstall,u=""){try{this.plugin.settings.debuggingMode&&console.log("BRAT: addPlugin",t,e,n,i,o,r,a,u?"private":"public");let l=10,c=await this.validateRepository(t,!0,!0,o,u),p=!!c;if(p||(c=await this.validateRepository(t,!1,!0,o,u)),c===null){let f=`${t}
A manifest.json file does not exist in the latest release of the repository. This plugin cannot be installed.`;return await this.plugin.log(f,!0),h(this.plugin,f,l),!1}if(!Object.hasOwn(c,"version")){let f=`${t}
The manifest.json file in the latest release or pre-release of the repository does not have a version number in the file. This plugin cannot be installed.`;return await this.plugin.log(f,!0),h(this.plugin,f,l),!1}if(!Object.hasOwn(c,"minAppVersion")&&!(0,O.requireApiVersion)(c.minAppVersion)){let f=`Plugin: ${t}

The manifest.json for this plugin indicates that the Obsidian version of the app needs to be ${c.minAppVersion}, but this installation of Obsidian is ${O.apiVersion}. 

You will need to update your Obsidian to use this plugin or contact the plugin developer for more information.`;return await this.plugin.log(f,!0),h(this.plugin,f,30),!1}let E=async()=>{let f=await this.getAllReleaseFiles(t,c,p,o,u);if(console.log("rFiles",f),(p||f.manifest==="")&&(f.manifest=JSON.stringify(c)),this.plugin.settings.debuggingMode&&console.log("BRAT: rFiles.manifest",p,f),f.mainJs===null){let y=`${t}
The release is not complete and cannot be download. main.js is missing from the Release`;return await this.plugin.log(y,!0),h(this.plugin,y,l),null}return f};if(!e||r){let f=await E();if(f===null)return!1;if(await this.writeReleaseFilesToPluginFolder(c.id,f),r||wt(this.plugin,t,o,u),a){let{plugins:y}=this.plugin.app,v=(0,O.normalizePath)(`${y.getPluginFolder()}/${c.id}`);await y.loadManifest(v),await y.enablePluginAndSave(c.id)}if(await this.plugin.app.plugins.loadManifests(),r)await this.reloadPlugin(c.id),await this.plugin.log(`${t} reinstalled`,!0),h(this.plugin,`${t}
Plugin has been reinstalled and reloaded with version ${c.version}`,l);else{let y=o===""?"":` (version: ${o})`,v=`${t}${y}
The plugin has been registered with BRAT.`;a||(v+=" You may still need to enable it the Community Plugin List."),await this.plugin.log(v,!0),h(this.plugin,v,l)}}else{let f=`${this.plugin.app.vault.configDir}/plugins/${c.id}/`,y="";try{y=await this.plugin.app.vault.adapter.read(`${f}manifest.json`)}catch(N){if(N.errno===-4058||N.errno===-2)return await this.addPlugin(t,!1,p,!1,o,!1,a,u),!0;console.log("BRAT - Local Manifest Load",c.id,JSON.stringify(N,null,2))}if(o!==""&&o!=="latest")return h(this.plugin,`The version of ${t} is frozen, not updating.`,3),!1;let v=await JSON.parse(y),T=ye(v.version,{includePrerelease:!0,loose:!0}),w=ye(c.version,{includePrerelease:!0,loose:!0});if(It(T,w)===-1){let N=await E();if(N===null)return!1;if(n){let ue=`There is an update available for ${c.id} from version ${v.version} to ${c.version}. `;return await this.plugin.log(`${ue}[Release Info](https://github.com/${t}/releases/tag/${c.version})`,!0),h(this.plugin,ue,30,()=>{c&&window.open(`https://github.com/${t}/releases/tag/${c.version}`)}),!1}await this.writeReleaseFilesToPluginFolder(c.id,N),await this.plugin.app.plugins.loadManifests(),await this.reloadPlugin(c.id);let $=`${c.id}
Plugin has been updated from version ${v.version} to ${c.version}. `;return await this.plugin.log(`${$}[Release Info](https://github.com/${t}/releases/tag/${c.version})`,!0),h(this.plugin,$,30,()=>{c&&window.open(`https://github.com/${t}/releases/tag/${c.version}`)}),!0}return i&&h(this.plugin,`No update available for ${t}`,3),!0}}catch(l){console.error(`BRAT: Error adding plugin ${t}:`,{error:l,updatePluginFiles:e,seeIfUpdatedOnly:n,specifyVersion:o,forceReinstall:r});let c=l instanceof Error?l.message:"Unknown error occurred";return await this.plugin.log(`Error ${e?"updating":"adding"} plugin ${t}: ${c}`,!0),!1}return!0}async reloadPlugin(t){let{plugins:e}=this.plugin.app;try{await e.disablePlugin(t),await e.enablePlugin(t)}catch(n){this.plugin.settings.debuggingMode&&console.log("reload plugin",n)}}async updatePlugin(t,e=!1,n=!1,i=!1,o=""){let r=await this.addPlugin(t,!0,e,n,"",i,!1,o);return!r&&!e&&h(this.plugin,`${t}
Update of plugin failed.`),r}async checkForPluginUpdatesAndInstallUpdates(t=!1,e=!1){var a,u;if(!await Ee()){console.log("BRAT: No internet detected.");return}let n,i="Checking for plugin updates STARTED";await this.plugin.log(i,!0),t&&this.plugin.settings.notificationsEnabled&&(n=new O.Notice(`BRAT
${i}`,3e4));let o=new Map(this.plugin.settings.pluginSubListFrozenVersion.map(l=>[l.repo,{version:l.version,token:l.token}]));for(let l of this.plugin.settings.pluginList)o.has(l)&&((a=o.get(l))==null?void 0:a.version)!=="latest"||await this.updatePlugin(l,e,!1,!1,(u=o.get(l))==null?void 0:u.token);let r="Checking for plugin updates COMPLETED";await this.plugin.log(r,!0),t&&(n&&n.hide(),h(this.plugin,r,10))}deletePlugin(t){let e=`Removed ${t} from BRAT plugin list`;this.plugin.log(e,!0),this.plugin.settings.pluginList=this.plugin.settings.pluginList.filter(n=>n!==t),this.plugin.settings.pluginSubListFrozenVersion=this.plugin.settings.pluginSubListFrozenVersion.filter(n=>n.repo!==t),this.plugin.saveSettings()}getEnabledDisabledPlugins(t){let e=this.plugin.app.plugins,n=Object.values(e.manifests),i=Object.values(e.plugins).map(o=>o.manifest);return t?n.filter(o=>i.find(r=>o.id===r.id)):n.filter(o=>!i.find(r=>o.id===r.id))}};var _=require("obsidian");var Z=async(s,t,e)=>{let n=await U(t,!0,s.settings.debuggingMode);if(n||(n=await U(t,!1,s.settings.debuggingMode)),!n)return h(s,"There is no theme.css or theme-beta.css file in the root path of this repository, so there is no theme to install."),!1;let i=await ft(t,s.settings.debuggingMode);if(!i)return h(s,"There is no manifest.json file in the root path of this repository, so theme cannot be installed."),!1;let o=await JSON.parse(i),r=(0,_.normalizePath)($n(s)+o.name),{adapter:a}=s.app.vault;await a.exists(r)||await a.mkdir(r),await a.write((0,_.normalizePath)(`${r}/theme.css`),n),await a.write((0,_.normalizePath)(`${r}/manifest.json`),i),vt(s,t,Y(n));let u="";return e?(Et(s,t,n),u=`${o.name} theme installed from ${t}. `,setTimeout(()=>{s.app.customCss.setTheme(o.name)},500)):u=`${o.name} theme updated from ${t}.`,s.log(`${u}[Theme Info](https://github.com/${t})`,!1),h(s,u,20,()=>{window.open(`https://github.com/${t}`)}),!0},j=async(s,t)=>{if(!await Ee()){console.log("BRAT: No internet detected.");return}let e,n="Checking for beta theme updates STARTED";await s.log(n,!0),t&&s.settings.notificationsEnabled&&(e=new _.Notice(`BRAT
${n}`,3e4));for(let o of s.settings.themesList){let r=await W(o.repo,!0,s.settings.debuggingMode);r==="0"&&(r=await W(o.repo,!1,s.settings.debuggingMode)),console.log("BRAT: lastUpdateOnline",r),r!==o.lastUpdate&&await Z(s,o.repo,!1)}let i="Checking for beta theme updates COMPLETED";(async()=>await s.log(i,!0))(),t&&(s.settings.notificationsEnabled&&e&&e.hide(),h(s,i))},ve=(s,t)=>{s.settings.themesList=s.settings.themesList.filter(n=>n.repo!==t),s.saveSettings();let e=`Removed ${t} from BRAT themes list and will no longer be updated. However, the theme files still exist in the vault. To remove them, go into Settings > Appearance and remove the theme.`;s.log(e,!0),h(s,e)},$n=s=>`${(0,_.normalizePath)(`${s.app.vault.configDir}/themes`)}/`;var H=require("obsidian");var x=class extends H.Modal{constructor(t,e=!1){super(t.app),this.plugin=t,this.address="",this.openSettingsTabAfterwards=e}async submitForm(){if(this.address==="")return;let t=this.address.replace("https://github.com/","");if(yt(this.plugin,t)){h(this.plugin,"This theme is already in the list for beta testing",10);return}await Z(this.plugin,t,!0)&&this.close()}onOpen(){this.contentEl.createEl("h4",{text:"Github repository for beta theme:"}),this.contentEl.createEl("form",{},t=>{t.addClass("brat-modal"),new H.Setting(t).addText(i=>{i.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name"),i.setValue(this.address),i.onChange(o=>{this.address=o.trim()}),i.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.address!==" "&&(o.preventDefault(),this.submitForm())}),i.inputEl.style.width="100%",window.setTimeout(()=>{let o=document.querySelector(".setting-item-info");o&&o.remove(),i.inputEl.focus()},10)}),t.createDiv("modal-button-container",i=>{new H.ButtonComponent(i).setButtonText("Never mind").onClick(()=>{this.close()}),new H.ButtonComponent(i).setButtonText("Add theme").setCta().onClick(o=>{o.preventDefault(),console.log("Add theme button clicked"),this.address!==""&&this.submitForm()})});let e=t.createDiv();e.style.borderTop="1px solid #ccc",e.style.marginTop="30px";let n=e.createSpan();n.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",n.style.fontStyle="italic",e.appendChild(n),G(e,!1),window.setTimeout(()=>{let i=t.querySelectorAll(".brat-modal .setting-item-info");for(let o of Array.from(i))o.remove()},50)})}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.openTab(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}};var At=require("obsidian"),A=class extends At.FuzzySuggestModal{constructor(e){super(e.app);this.data=[];this.scope.register(["Shift"],"Enter",n=>{this.enterTrigger(n)}),this.scope.register(["Ctrl"],"Enter",n=>{this.enterTrigger(n)})}setSuggesterData(e){this.data=e}display(e){this.callbackFunction=e,this.open()}getItems(){return this.data}getItemText(e){return e.display}onChooseItem(){}renderSuggestion(e,n){n.createEl("div",{text:e.item.display})}enterTrigger(e){var o;let n=(o=document.querySelector(".suggestion-item.is-selected div"))==null?void 0:o.textContent,i=this.data.find(r=>r.display===n);i&&(this.invokeCallback(i,e),this.close())}onChooseSuggestion(e,n){this.invokeCallback(e.item,n)}invokeCallback(e,n){typeof this.callbackFunction=="function"&&this.callbackFunction(e,n)}};var K=class{constructor(t){this.bratCommands=[{id:"AddBetaPlugin",icon:"BratIcon",name:"Plugins: Add a beta plugin for testing (with or without version)",showInRibbon:!0,callback:()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!1,!0)}},{id:"checkForUpdatesAndUpdate",icon:"BratIcon",name:"Plugins: Check for updates to all beta plugins and UPDATE",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!1)}},{id:"checkForUpdatesAndDontUpdate",icon:"BratIcon",name:"Plugins: Only check for updates to beta plugins, but don't Update",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!0)}},{id:"updateOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin version to update",showInRibbon:!0,callback:()=>{let t=new Map(this.plugin.settings.pluginSubListFrozenVersion.map(i=>[i.repo,{version:i.version,token:i.token}])),e=Object.values(this.plugin.settings.pluginList).filter(i=>{let o=t.get(i);return!(o!=null&&o.version)||o.version==="latest"}).map(i=>{let o=t.get(i);return{display:i,info:i}}),n=new A(this.plugin);n.setSuggesterData(e),n.display(i=>{let o=`Checking for updates for ${i.info}`,r=t.get(i.info);this.plugin.log(o,!0),h(this.plugin,`
${o}`,3),this.plugin.betaPlugins.updatePlugin(i.info,!1,!0,!1,r==null?void 0:r.token)})}},{id:"reinstallOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin to reinstall",showInRibbon:!0,callback:()=>{let t=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(i=>i.repo)),e=Object.values(this.plugin.settings.pluginList).filter(i=>!t.has(i)).map(i=>({display:i,info:i})),n=new A(this.plugin);n.setSuggesterData(e),n.display(i=>{let o=`Reinstalling ${i.info}`;h(this.plugin,`
${o}`,3),this.plugin.log(o,!0),this.plugin.betaPlugins.updatePlugin(i.info,!1,!1,!0)})}},{id:"restartPlugin",icon:"BratIcon",name:"Plugins: Restart a plugin that is already installed",showInRibbon:!0,callback:()=>{let t=Object.values(this.plugin.app.plugins.manifests).map(n=>({display:n.id,info:n.id})),e=new A(this.plugin);e.setSuggesterData(t),e.display(n=>{h(this.plugin,`${n.info}
Plugin reloading .....`,5),this.plugin.betaPlugins.reloadPlugin(n.info)})}},{id:"disablePlugin",icon:"BratIcon",name:"Plugins: Disable a plugin - toggle it off",showInRibbon:!0,callback:()=>{let t=this.plugin.betaPlugins.getEnabledDisabledPlugins(!0).map(n=>({display:`${n.name} (${n.id})`,info:n.id})),e=new A(this.plugin);e.setSuggesterData(t),e.display(n=>{this.plugin.log(`${n.display} plugin disabled`,!1),this.plugin.settings.debuggingMode&&console.log(n.info),this.plugin.app.plugins.disablePluginAndSave(n.info)})}},{id:"enablePlugin",icon:"BratIcon",name:"Plugins: Enable a plugin - toggle it on",showInRibbon:!0,callback:()=>{let t=this.plugin.betaPlugins.getEnabledDisabledPlugins(!1).map(n=>({display:`${n.name} (${n.id})`,info:n.id})),e=new A(this.plugin);e.setSuggesterData(t),e.display(n=>{this.plugin.log(`${n.display} plugin enabled`,!1),this.plugin.app.plugins.enablePluginAndSave(n.info)})}},{id:"openGitHubZRepository",icon:"BratIcon",name:"Plugins: Open the GitHub repository for a plugin",showInRibbon:!0,callback:async()=>{let t=await mt(this.plugin.settings.debuggingMode);if(t){let e=Object.values(t).map(o=>({display:`Plugin: ${o.name}  (${o.repo})`,info:o.repo})),n=Object.values(this.plugin.settings.pluginList).map(o=>({display:`BRAT: ${o}`,info:o}));for(let o of e)n.push(o);let i=new A(this.plugin);i.setSuggesterData(n),i.display(o=>{o.info&&window.open(`https://github.com/${o.info}`)})}}},{id:"openGitHubRepoTheme",icon:"BratIcon",name:"Themes: Open the GitHub repository for a theme (appearance)",showInRibbon:!0,callback:async()=>{let t=await ht(this.plugin.settings.debuggingMode);if(t){let e=Object.values(t).map(i=>({display:`Theme: ${i.name}  (${i.repo})`,info:i.repo})),n=new A(this.plugin);n.setSuggesterData(e),n.display(i=>{i.info&&window.open(`https://github.com/${i.info}`)})}}},{id:"opentPluginSettings",icon:"BratIcon",name:"Plugins: Open Plugin Settings Tab",showInRibbon:!0,callback:()=>{let t=this.plugin.app.setting,e=Object.values(t.pluginTabs).map(o=>({display:`Plugin: ${o.name}`,info:o.id})),n=new A(this.plugin),i=Object.values(t.settingTabs).map(o=>({display:`Core: ${o.name}`,info:o.id}));for(let o of e)i.push(o);n.setSuggesterData(i),n.display(o=>{t.open(),t.openTabById(o.info)})}},{id:"GrabBetaTheme",icon:"BratIcon",name:"Themes: Grab a beta theme for testing from a Github repository",showInRibbon:!0,callback:()=>{new x(this.plugin).open()}},{id:"updateBetaThemes",icon:"BratIcon",name:"Themes: Update beta themes",showInRibbon:!0,callback:async()=>{await j(this.plugin,!0)}},{id:"allCommands",icon:"BratIcon",name:"All Commands list",showInRibbon:!1,callback:()=>{this.ribbonDisplayCommands()}}];this.plugin=t;for(let e of this.bratCommands)this.plugin.addCommand({id:e.id,name:e.name,icon:e.icon,callback:()=>{e.callback()}})}ribbonDisplayCommands(){let t=[];for(let r of this.bratCommands)r.showInRibbon&&t.push({display:r.name,info:r.callback});let e=new A(this.plugin),n=this.plugin.app.setting,i=Object.values(n.settingTabs).map(r=>({display:`Core: ${r.name}`,info:()=>{n.open(),n.openTabById(r.id)}})),o=Object.values(n.pluginTabs).map(r=>({display:`Plugin: ${r.name}`,info:()=>{n.open(),n.openTabById(r.id)}}));t.push({display:"---- Core Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let r of i)t.push(r);t.push({display:"---- Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let r of o)t.push(r);e.setSuggesterData(t),e.display(r=>{typeof r.info=="function"&&r.info()})}};var R=require("obsidian");var Pe=class extends R.PluginSettingTab{constructor(e,n){super(e,n);this.accessTokenSetting=null;this.accessTokenButton=null;this.tokenInfo=null;this.plugin=n}display(){let{containerEl:e}=this;e.empty(),e.addClass("brat-settings"),new R.Setting(e).setName("Auto-enable plugins after installation").setDesc('If enabled beta plugins will be automatically enabled after installtion by default. Note: you can toggle this on and off for each plugin in the "Add Plugin" form.').addToggle(i=>{i.setValue(this.plugin.settings.enableAfterInstall).onChange(async o=>{this.plugin.settings.enableAfterInstall=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Auto-update plugins at startup").setDesc("If enabled all beta plugins will be checked for updates each time Obsidian starts. Note: this does not update frozen version plugins.").addToggle(i=>{i.setValue(this.plugin.settings.updateAtStartup).onChange(async o=>{this.plugin.settings.updateAtStartup=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Auto-update themes at startup").setDesc("If enabled all beta themes will be checked for updates each time Obsidian starts.").addToggle(i=>{i.setValue(this.plugin.settings.updateThemesAtStartup).onChange(async o=>{this.plugin.settings.updateThemesAtStartup=o,await this.plugin.saveSettings()})}),G(e,!0),e.createEl("hr"),new R.Setting(e).setName("Beta plugin list").setHeading(),e.createEl("div",{text:'The following is a list of beta plugins added via the command "Add a beta plugin for testing". You can chose to add the latest version or a frozen version. A frozen version is a specific release of a plugin based on its release tag.'}),e.createEl("p"),e.createEl("div",{text:"Click the 'Edit' button next to a plugin to change the installed version and the x button next to a plugin to remove it from the list."}),e.createEl("p"),e.createEl("span").createEl("b",{text:"Note: "}),e.createSpan({text:"Removing from the list does not delete the plugin, this should be done from the Community Plugins tab in Settings."}),new R.Setting(e).addButton(i=>{i.setButtonText("Add beta plugin").setCta().onClick(()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0)})});let n=new Map(this.plugin.settings.pluginSubListFrozenVersion.map(i=>[i.repo,{version:i.version,token:i.token}]));for(let i of this.plugin.settings.pluginList){let o=n.get(i),r=new R.Setting(e).setName(J(i)).setDesc(o!=null&&o.version?` Tracked version: ${o.version} ${o.version==="latest"?"":"(frozen)"}`:"");(!(o!=null&&o.version)||o.version==="latest")&&r.addButton(a=>{a.setIcon("sync").setTooltip("Check and update plugin").onClick(async()=>{await this.plugin.betaPlugins.updatePlugin(i,!1,!0,!1,o==null?void 0:o.token)})}),r.addButton(a=>{a.setIcon("edit").setTooltip("Change version").onClick(()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0,i,o==null?void 0:o.version,o==null?void 0:o.token),this.plugin.app.setting.updatePluginSection()})}).addButton(a=>{a.setIcon("cross").setTooltip("Remove this beta plugin").setWarning().onClick(()=>{if(a.buttonEl.textContent==="")a.setButtonText("Click once more to confirm removal");else{let{buttonEl:u}=a,{parentElement:l}=u;l!=null&&l.parentElement&&(l.parentElement.remove(),this.plugin.betaPlugins.deletePlugin(i))}})})}new R.Setting(e).setName("Beta themes list").setHeading(),new R.Setting(e).addButton(i=>{i.setButtonText("Add beta theme").setCta().onClick(()=>{this.plugin.app.setting.close(),new x(this.plugin).open()})});for(let i of this.plugin.settings.themesList)new R.Setting(e).setName(J(i.repo)).addButton(o=>{o.setIcon("cross").setTooltip("Delete this beta theme").onClick(()=>{if(o.buttonEl.textContent==="")o.setButtonText("Click once more to confirm removal");else{let{buttonEl:r}=o,{parentElement:a}=r;a!=null&&a.parentElement&&(a.parentElement.remove(),ve(this.plugin,i.repo))}})});new R.Setting(e).setName("Monitoring").setHeading(),new R.Setting(e).setName("Enable notifications").setDesc("BRAT will provide popup notifications for its various activities. Turn this off means  no notifications from BRAT.").addToggle(i=>{i.setValue(this.plugin.settings.notificationsEnabled),i.onChange(async o=>{this.plugin.settings.notificationsEnabled=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Enable logging").setDesc("Plugin updates will be logged to a file in the log file.").addToggle(i=>{i.setValue(this.plugin.settings.loggingEnabled).onChange(async o=>{this.plugin.settings.loggingEnabled=o,await this.plugin.saveSettings()})}),new R.Setting(this.containerEl).setName("BRAT log file location").setDesc("Logs will be saved to this file. Don't add .md to the file name.").addSearch(i=>{i.setPlaceholder("Example: BRAT-log").setValue(this.plugin.settings.loggingPath).onChange(async o=>{this.plugin.settings.loggingPath=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Enable verbose logging").setDesc("Get a lot  more information in  the log.").addToggle(i=>{i.setValue(this.plugin.settings.loggingVerboseEnabled).onChange(async o=>{this.plugin.settings.loggingVerboseEnabled=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Debugging mode").setDesc("Atomic Bomb level console logging. Can be used for troubleshoting and development.").addToggle(i=>{i.setValue(this.plugin.settings.debuggingMode).onChange(async o=>{this.plugin.settings.debuggingMode=o,await this.plugin.saveSettings()})}),new R.Setting(e).setName("Personal access token").setDesc(Pt({prependText:"Set a personal access token to increase rate limits for public repositories on GitHub. You can create one in ",url:"https://github.com/settings/tokens/new?scopes=public_repo",text:"your GitHub account settings",appendText:" and then add it here. Please consult the documetation for more details."})).addText(i=>{var o,r;this.accessTokenSetting=i,i.setPlaceholder("Enter your personal access token").setValue((o=this.plugin.settings.personalAccessToken)!=null?o:"").onChange(async a=>{var u,l;a===""?(this.plugin.settings.personalAccessToken="",this.plugin.saveSettings(),(u=this.accessTokenButton)==null||u.setDisabled(!0),this.updateTokenInfo(this.tokenInfo,null)):(l=this.accessTokenButton)==null||l.setDisabled(!1)}),Fe((r=this.plugin.settings.personalAccessToken)!=null?r:"").then(a=>{var u;a.validToken&&((u=this.accessTokenButton)==null||u.setDisabled(!0)),this.updateTokenInfo(this.tokenInfo,this.plugin.settings.personalAccessToken?a:null)})}).addButton(i=>{this.accessTokenButton=i,i.setButtonText("Validate").setCta().onClick(async()=>{var r,a;let o=(r=this.accessTokenSetting)==null?void 0:r.inputEl.value;if(o){let u=await Fe(o);await this.updateTokenInfo(this.tokenInfo,u),u.validToken&&(this.plugin.settings.personalAccessToken=o,this.plugin.saveSettings(),(a=this.accessTokenButton)==null||a.setDisabled(!0))}})}),this.tokenInfo=this.createTokenInfoElement(e)}createTokenInfoElement(e){let n=e.createDiv({cls:"brat-token-info"});return n.createDiv({cls:"brat-token-status"}),n.createDiv({cls:"brat-token-details"}),n}async updateTokenInfo(e,n){if(!e)return;let i=e.querySelector(".brat-token-status"),o=e.querySelector(".brat-token-details");if(!(!i||!o)){if(e.removeClass("valid","invalid"),i.empty(),o.empty(),!n){e.addClass("invalid"),i.setText("No token provided");return}if(!n.validToken){e.addClass("invalid"),n.error.type==="invalid_format"?i.setText("\u26A0\uFE0F Invalid token format. Please verify your token."):n.error.type==="invalid_prefix"?i.setText("\u26A0\uFE0F Invalid token prefix. Valid tokens for BRAT start with `ghp_` or `github_pat_`."):i.setText("\u26A0\uFE0F Invalid token. Please verify that the token has the right permissions / scope and is not expired.");return}if(n.validToken&&(e.addClass("valid"),i.setText("\u2713 Valid token"),n.rateLimit&&o.createDiv({text:`API Rate Limit: ${n.rateLimit.remaining}/${n.rateLimit.limit}`}),n.expirationDate)){let r=new Date(n.expirationDate),a=Math.ceil((r.getTime()-Date.now())/(1e3*60*60*24));a<7&&o.createDiv({text:`\u26A0\uFE0F Token expires in ${a} days`,cls:"brat-token-warning"})}}}};var Lt=require("obsidian");function Ct(){(0,Lt.addIcon)("BratIcon",'<path fill="currentColor" stroke="currentColor"  d="M 41.667969 41.667969 C 41.667969 39.367188 39.800781 37.5 37.5 37.5 C 35.199219 37.5 33.332031 39.367188 33.332031 41.667969 C 33.332031 43.96875 35.199219 45.832031 37.5 45.832031 C 39.800781 45.832031 41.667969 43.96875 41.667969 41.667969 Z M 60.417969 58.582031 C 59.460938 58.023438 58.320312 57.867188 57.25 58.148438 C 56.179688 58.429688 55.265625 59.125 54.707031 60.082031 C 53.746094 61.777344 51.949219 62.820312 50 62.820312 C 48.050781 62.820312 46.253906 61.777344 45.292969 60.082031 C 44.734375 59.125 43.820312 58.429688 42.75 58.148438 C 41.679688 57.867188 40.539062 58.023438 39.582031 58.582031 C 37.597656 59.726562 36.910156 62.257812 38.042969 64.25 C 40.5 68.53125 45.0625 71.171875 50 71.171875 C 54.9375 71.171875 59.5 68.53125 61.957031 64.25 C 63.089844 62.257812 62.402344 59.726562 60.417969 58.582031 Z M 62.5 37.5 C 60.199219 37.5 58.332031 39.367188 58.332031 41.667969 C 58.332031 43.96875 60.199219 45.832031 62.5 45.832031 C 64.800781 45.832031 66.667969 43.96875 66.667969 41.667969 C 66.667969 39.367188 64.800781 37.5 62.5 37.5 Z M 50 8.332031 C 26.988281 8.332031 8.332031 26.988281 8.332031 50 C 8.332031 73.011719 26.988281 91.667969 50 91.667969 C 73.011719 91.667969 91.667969 73.011719 91.667969 50 C 91.667969 26.988281 73.011719 8.332031 50 8.332031 Z M 50 83.332031 C 33.988281 83.402344 20.191406 72.078125 17.136719 56.363281 C 14.078125 40.644531 22.628906 24.976562 37.5 19.042969 C 37.457031 19.636719 37.457031 20.238281 37.5 20.832031 C 37.5 27.738281 43.097656 33.332031 50 33.332031 C 52.300781 33.332031 54.167969 31.46875 54.167969 29.167969 C 54.167969 26.867188 52.300781 25 50 25 C 47.699219 25 45.832031 23.132812 45.832031 20.832031 C 45.832031 18.53125 47.699219 16.667969 50 16.667969 C 68.410156 16.667969 83.332031 31.589844 83.332031 50 C 83.332031 68.410156 68.410156 83.332031 50 83.332031 Z M 50 83.332031 " />')}var ee=class{constructor(t){this.console=(t,...e)=>{console.log(`BRAT: ${t}`,...e)};this.themes={themeseCheckAndUpates:async t=>{await j(this.plugin,t)},themeInstallTheme:async t=>{let e=t.replace("https://github.com/","");await Z(this.plugin,e,!0)},themesDelete:t=>{let e=t.replace("https://github.com/","");ve(this.plugin,e)},grabCommmunityThemeCssFile:async(t,e=!1)=>await U(t,e,this.plugin.settings.debuggingMode),grabChecksumOfThemeCssFile:async(t,e=!1)=>await W(t,e,this.plugin.settings.debuggingMode),grabLastCommitDateForFile:async(t,e)=>await bt(t,e)};this.plugin=t}};var le=require("obsidian"),jt=Kt(Gt());async function zt(s,t,e=!1){if(s.settings.debuggingMode&&console.log(`BRAT: ${t}`),s.settings.loggingEnabled){if(!s.settings.loggingVerboseEnabled&&e)return;let n=`${s.settings.loggingPath}.md`,i=`[[${(0,le.moment)().format((0,jt.getDailyNoteSettings)().format).toString()}]] ${(0,le.moment)().format("HH:mm")}`,o=window.require("os"),r=le.Platform.isDesktop?o.hostname():"MOBILE",a=`${i} ${r} ${t.replace(`
`," ")}
`,u=s.app.vault.getAbstractFileByPath(n);u?await s.app.vault.append(u,a):u=await s.app.vault.create(n,a)}}var Re=class extends qt.Plugin{constructor(){super(...arguments);this.APP_NAME="BRAT";this.APP_ID="obsidian42-brat";this.settings=Me;this.betaPlugins=new Q(this);this.commands=new K(this);this.bratApi=new ee(this);this.obsidianProtocolHandler=e=>{if(!e.plugin&&!e.theme){h(this,"Could not locate the repository from the URL.",10);return}for(let n of["plugin","theme"])if(e[n]){let i;switch(n){case"plugin":i=new B(this,this.betaPlugins,!0,!1,e[n],e.version?e.version:void 0),i.open();break;case"theme":i=new x(this),i.address=e[n],i.open();break}return}}}onload(){console.log(`loading ${this.APP_NAME}`),Ct(),this.addRibbonIcon("BratIcon","BRAT",()=>{this.commands.ribbonDisplayCommands()}),this.loadSettings().then(()=>{this.app.workspace.onLayoutReady(()=>{this.addSettingTab(new Pe(this.app,this)),this.registerObsidianProtocolHandler("brat",this.obsidianProtocolHandler),this.settings.updateAtStartup&&setTimeout(()=>{this.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!1)},6e4),this.settings.updateThemesAtStartup&&setTimeout(()=>{j(this,!1)},12e4),setTimeout(()=>{window.bratAPI=this.bratApi},500)})}).catch(e=>{console.error("Failed to load settings:",e)})}async log(e,n=!1){await zt(this,e,n)}onunload(){console.log(`unloading ${this.APP_NAME}`)}async loadSettings(){this.settings=Object.assign({},Me,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
